<!DOCTYPE HTML>

<html>

<head>
   <meta charset="utf-8">
   <link rel="stylesheet" href="bug.css"/>
</head>

<body id="test">
   
   <div id="stack">
      <canvas id="mycanvas"></canvas>
      <canvas id="effectcanvas"></canvas>
      <canvas id="hudcanvas"></canvas>
  <div>
  
   <script type="text/javascript" src="constants.js"></script>
   <script type="text/javascript" src="generator.js"></script>
   <script type="text/javascript" src="effect.js"></script>
   <script type="text/javascript" src="objects.js"></script>
   <script type="text/javascript" src="room.js"></script>
   <script type="text/javascript" src="game.js"></script>
   <script type="text/javascript" src="hud.js"></script>
   <script type="text/javascript" src="bug.js"></script>
   <script type="text/javascript">

      const KeyEnum = {
         wait: 32,
         forward: 38,
         backward: 40,
         left: 37,
         right: 39,
         info: 18
      };
      draw();
      
      window.addEventListener('click', (e) => { 
         if (state == StateEnum.Running) {
            new Effect(e.pageX, e.pageY);
         }
      });
      
      window.addEventListener('keydown', (e) => { 
         if (state == StateEnum.Running && e.keyCode == KeyEnum.info) {
            showInfo = true;
            e.preventDefault();
            draw();
         }
      });
      
      window.addEventListener('keyup', async (e) => {
         if (state == StateEnum.Beginning) {
            generate().then(async () => {
               console.log("Generated!");
               game = new Game;
               await game.build();
               state = StateEnum.Running;   
               draw();
            });
         } else if (state == StateEnum.Running) {
            if (e.keyCode == KeyEnum.forward) {
               if (isMoveValid(game.player.x, game.player.y - 1)) {
                  game.player.y--;
                  update();
                  draw();
               }
               e.preventDefault();
            } else if (e.keyCode == KeyEnum.backward) {
               if (isMoveValid(game.player.x, game.player.y + 1)) {
                  game.player.y++;
                  update();
                  draw();
               }
               e.preventDefault();
            } else if (e.keyCode == KeyEnum.left) {
               if (isMoveValid(game.player.x - 1, game.player.y)) {
                  game.player.x--;
                  update();
                  draw();
               }
               e.preventDefault();
            } else if (e.keyCode == KeyEnum.right) {
               if (isMoveValid(game.player.x + 1, game.player.y)) {
                  game.player.x++;
                  update();
                  draw();
               }
               e.preventDefault();
            } else if (e.keyCode == KeyEnum.wait) {
               update();
               draw();
               e.preventDefault();
            }
         } else if (state == StateEnum.End) {
            state = StateEnum.Beginning;
            draw();
         }
         if (e.keyCode == KeyEnum.info) {
            showInfo = false;
            e.preventDefault();
            draw();
         }
      });


   </script>


</body>

</html>